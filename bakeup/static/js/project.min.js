String.prototype.width=function(e){var t=e||"12px arial",o=$("<div></div>").text(this).css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden",font:t}).appendTo($("body")),a=o.width();return o.remove(),a};let arrowWidth=40;$.fn.resizeselect=function(e){return this.each((function(){let e=0;$(this).find("option").each((function(){let t=$(this),o=window.getComputedStyle(this),{fontWeight:a,fontSize:n,fontFamily:s}=o,d=t.text(),r=$("<div></div>").text(d).css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden","font-size":n,"font-weight":a,"font-family":s}).appendTo($("body")),i=r.width();i>e&&(e=i),r.remove()})),$(this).width(e+arrowWidth)}))},$(document).ready((function(){$("select.resizeselect").resizeselect();var e=[].slice.call(document.querySelectorAll(".toast")).map((function(e){return new bootstrap.Toast(e)}));console.log(e),e.forEach((e=>e.show())),location.hash&&$("button[data-bs-target='"+location.hash+"']").tab("show"),$(document.body).on("click","button[data-bs-toggle='tab']",(function(e){location.hash=this.getAttribute("data-bs-target")})),$(".customer-order-form").each((function(){console.log("preventLeaving",!$(this).hasClass("existing-order")),$(this).dirty({preventLeaving:$(this).hasClass("prevent-leaving"),leavingMessage:"Du hast deinen Brotkorb noch nicht abgeschickt. Willst du wirklich die Seite verlassen?"})}))})),$(window).on("popstate",(function(){var e=location.hash||$("button[data-bs-toggle='tab']").first().attr("data-bs-target");$("button[data-bs-target='"+e+"']").tab("show")}));var popoverTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')),popoverList=popoverTriggerList.map((function(e){return new bootstrap.Popover(e)})),addButton=document.querySelector(".add-another-form"),totalForms=document.querySelector("#id_form-TOTAL_FORMS"),saveButton=document.querySelector(".save-another-form");function addRemoveButtonEvent(e){for(let t=0;t<e.length;t++)e[t].addEventListener("click",removeForm)}function addForm(e){e.preventDefault(),saveButton.classList.remove("d-none");var t=parseInt(totalForms.value),o=form[0].cloneNode(!0);RegExp("form-(\\d){1}-","g");o.classList.remove("d-none"),console.log(o),o.innerHTML=o.innerHTML.replace(/__prefix__/g,`${t}`),o.querySelector(`#id_form-${t}-weight`).required=!0,console.log(form[0]),container.insertBefore(o,form[0]),totalForms.setAttribute("value",`${t+1}`),addRemoveButtonEvent(document.querySelectorAll(".remove-another-form"))}addButton&&addButton.addEventListener("click",addForm);var removeButtons=document.querySelectorAll(".remove-another-form");function removeForm(e){console.log("click"),e.preventDefault(),e.target.closest(".list-group-item").remove();var t=parseInt(document.querySelector("#id_form-TOTAL_FORMS").value);totalForms.setAttribute("value",""+(t-1)),t-1==0&&saveButton.classList.add("d-none")}addRemoveButtonEvent(removeButtons);var sidebarToggler=document.querySelector(".sidebar-toggler");sidebarToggler&&sidebarToggler.addEventListener("click",toggleSidebar);var sidebarTogglerHide=document.querySelector(".sidebar-toggler-hide");function toggleSidebar(){const e=document.querySelector(".sidebar");"none"===window.getComputedStyle(e).display?(e.style.display="flex",sidebarTogglerHide.style.display="block"):(e.style.display="",sidebarTogglerHide.style.display="")}sidebarTogglerHide&&sidebarTogglerHide.addEventListener("click",toggleSidebar);let expandAll=document.getElementById("expand-all");function setTotalPrice(e){var t=0;e.find("table tbody tr.product").each((function(){if($(this).data("product-price")){var e=parseInt($(this).data("quantity"));t+=e*parseFloat($(this).data("product-price")).toFixed(2)}})),t>0?(e.find(".price").removeClass("d-none"),e.find(".price").addClass("table-row"),e.find(".price-total span").html(t.toLocaleString(void 0,{maximumFractionDigits:2,minimumFractionDigits:2}))):(e.find(".price").addClass("d-none"),e.find(".price").removeClass("table-row"),e.find(".price-total span").html()),console.log("TOTAL BASKET PRICE: ",t)}function setTotalBasketQuantity(e){var t=$("#basket"),o=0;$(".product-card .product-quantity").each((function(){var e=parseInt($(this).val());o+=e})),console.log("TOTAL BASKET QTY:",o),1===o?(t.find(".single").removeClass("d-none").show(),t.find(".plural").hide(),t.find(".empty").hide(),t.find(".current-order").hide()):o>1&&(t.find(".plural").removeClass("d-none").show(),t.find(".single").hide(),t.find(".empty").hide(),t.find(".plural .qty").html(o),t.find(".current-order").hide()),0==o?($("header .shopping-basket .order-quantity").hide(),t.find(".summary").hide(),t.hasClass("has-order")?t.find(".current-order").show():t.find(".empty").removeClass("d-none").show()):(t.find(".summary").removeClass("d-none").show(),t.find(".empty").hide(),o>0&&($("header .shopping-basket .order-quantity").removeClass("d-none"),$("header .shopping-basket .order-quantity").show().html(o)))}function updateModalChange(e){var t=e.find("form");console.log("changed"),t.find(".form-check.terms-conditions").removeClass("d-none").show(),t.find('input[type="reset"]').removeClass("d-none").show(),t.find("button.btn-update").removeClass("d-none").show(),t.find("button.btn-cancel").removeClass("d-none").hide(),t.find('a[data-bs-dismiss="modal"]').hide(),e.find(".modal-title span").removeClass("d-none").show(),t.find("table").show(),t.find(".message-empty-checkout").addClass("d-none").hide()}function updateModalUnchange(e){var t=e.find("form");console.log("unchanged"),t.find(".form-check.terms-conditions").removeClass("d-none").hide(),t.find("button.btn-update").removeClass("d-none").hide(),t.find("button.btn-cancel").removeClass("d-none").hide(),t.find('input[type="reset"]').removeClass("d-none").hide(),t.find('a[data-bs-dismiss="modal"]').show(),e.find(".modal-title span").removeClass("d-none").hide()}function updateModalStorno(e){console.log("storno");var t=e.find("form");t.find(".form-check.terms-conditions").removeClass("d-none").hide(),t.find(".form-check.terms-conditions input").attr("required",!1),t.find("button.btn-update").removeClass("d-none").hide(),t.find("button.btn-cancel").removeClass("d-none").show(),t.find('a[data-bs-dismiss="modal"]').hide(),t.find("table").hide(),t.find(".message-empty-checkout").removeClass("d-none").show()}function updateModalEmpty(e){console.log("empty");var t=e.find("form");t.find(".form-check.terms-conditions").removeClass("d-none").hide(),t.find("table").hide(),t.find(".message-empty-checkout").removeClass("d-none").show(),t.find('a[data-bs-dismiss="modal"]').removeClass("d-none").show(),t.find("button.btn-update").removeClass("d-none").hide(),t.find("button.btn-cancel").removeClass("d-none").hide()}function updateModal(e,t,o){var a=e.find("form");console.log("updateModal",t,o),0===t?updateModalUnchange(e):updateModalChange(e),0===o&&(a.hasClass("has_order")?updateModalStorno(e):updateModalEmpty(e))}function updateProduct(e,t,o,a){o=parseInt(o),console.log("Update product",t,o,a);var n=e.find("tr[data-product='"+t+"']"),s=n.data("ordered-quantity");n.data("basket-quantity",Math.max(0,o)),a&&(o=s+o),n.data("quantity",o),n.find("select.order-quantity").val(o),console.log("qty",o>0),o>0&&(n.css("display",""),n.removeClass("d-none"),n.addClass("table-row"),console.log("show row"));var d=n.data("product-price");d&&(d=parseFloat(d),(d*=o)>0?n.find(".sale-price").removeClass("d-none").find(".price").html(d.toLocaleString(void 0,{maximumFractionDigits:2,minimumFractionDigits:2})):n.find(".sale-price").addClass("d-none"))}expandAll&&(document.getElementById("expand-all").onclick=function(){console.log(this.getAttribute("aria-expanded")),this.setAttribute("aria-expanded","true"!==this.getAttribute("aria-expanded")),this.classList.toggle("show");var e=!1;this.classList.contains("show")&&(e=!0),document.querySelectorAll(".collapse").forEach((t=>{e?(t.classList.add("show"),document.querySelector('[data-bs-target="#'+t.id+'"]').setAttribute("aria-expanded",!0)):(t.classList.remove("show"),document.querySelector('[data-bs-target="#'+t.id+'"]').setAttribute("aria-expanded",!1))}))}),$("header .shopping-basket a").click((function(e){var t=document.querySelector(".modal-checkout");bootstrap.Modal.getOrCreateInstance(t).show()})),$(document).on("keyup","input.product-quantity",(function(){var e=$(this),t=parseInt(e.attr("min"))||1,o=parseInt(e.attr("max"))||100,a=parseInt(e.val())||t-1;a<t&&(a=t),a>o&&(a=o),e.val(a),setTotalBasketQuantity($(".modal-checkout"))}));let plus_btns=document.querySelectorAll(".input-group .btn-plus"),minus_btns=document.querySelectorAll(".input-group .btn-minus"),qty_inputs=document.querySelectorAll(".input-group input[type=number]");plus_btns.forEach((e=>{console.log(e.disabled),e.previousElementSibling.disabled||e.addEventListener("click",(()=>{var t=e.previousElementSibling.value==e.previousElementSibling.max?e.previousElementSibling.max:parseInt(e.previousElementSibling.value)+1;e.previousElementSibling.value=t,setTotalBasketQuantity($(".modal-checkout"))}))})),minus_btns.forEach((e=>{e.nextElementSibling.disabled||e.addEventListener("click",(()=>{var t=0==e.nextElementSibling.value?0:e.nextElementSibling.value-1;e.nextElementSibling.value=t,setTotalBasketQuantity($(".modal-checkout"))}))})),$(".modal-checkout .btn-delete, .modal-abo .btn-delete").click((function(){var e=$(this).parents("tr");e.hide(),e.find(".order-quantity").val(0).change()})),$(".modal-checkout form, .modal-abo form").on("reset",(function(e){console.log("reset");var t=$(this);setTimeout((function(){console.log(t.find("tbody tr.product select")),$(this).parents(".modal").find(".modal-title span").hide(),t.find("tbody tr.product select").change(),t.find(".form-check.terms-conditions").removeClass("d-none").hide(),t.find('button[type="submit"]').removeClass("d-none").hide(),t.find('input[type="reset"]').removeClass("d-none").hide(),t.find('a[data-bs-dismiss="modal"]').show(),t.dirty("setAsClean"),t.find("table").show(),t.find(".message-empty-checkout").addClass("d-none").hide(),t.find(".message-abo-orders").addClass("d-none")}))}));var aboProductDays={};$((function(){$(".link-new-tab a").attr("target","_blank"),$(".link-new-tab a").attr("rel","nofollow noopener"),$(".modal-checkout, .modal-abo").on("hide.bs.modal",(function(){$(this).find('form input[type="reset"]').click()})),$(".modal-checkout").on("show.bs.modal",(function(){var e=$(this);if($(this).hasClass("in-checkout")){var t=0,o=0;$(".product-card").each((function(){var a=$(this).data("product"),n=$(this).data("ordered-quantity"),s=parseInt($(this).find(".product-quantity").val())||0;o=o+n+s,t+=t+s,console.log(a,s),updateProduct(e,a,s,!0)})),setTotalPrice(e),console.log("basketQuantity",t),console.log("totalBasketQuantity",o),updateModal(e,t,o)}var a=e.data("production-day");$.get("/shop/api/production-day-abo-products/"+a+"/",(function(e,t){aboProductDays=e}))})),$(".modal-checkout.in-checkout").length&&(console.log("checkout exists"),$("header .shopping-basket").addClass("d-lg-block"));$(".modal-checkout form").serialize();$(".modal-checkout form select").change((function(){})),$(".modal-abo form select.order-quantity").change((function(){console.log("detect abo modal form change");var e=$(this).parents("form"),t=$(this).parents(".modal"),o=$(this).parents("tr").data("product");console.log($(this).val()),updateProduct(t,o,this.value,!1);var a=0;e.find("tr.product select").each((function(){var e=parseInt($(this).val());a+=e})),0===a?updateModalStorno(t):e.dirty("isDirty")?updateModalChange(t):updateModalUnchange(t)})),$(".modal-checkout form tr.product .abo-checkbox, .modal-checkout form tr.product select.order-quantity").change((function(){var e=$(this).parents("form"),t=[];console.log("aboProductDays",aboProductDays),e.find("tr.product .abo-checkbox:checked").each((function(){var e=$(this).attr("name").replace("productabo-",""),o=parseInt($(this).parents("tr.product").find("select.order-quantity").val());if(aboProductDays[e])for(const[a,n]of Object.entries(aboProductDays[e]))n-o>=0&&t.push(a)})),t.length?((t=Array.from(new Set(t))).sort(((e,t)=>e-t)),t=t.map((e=>new Date(e).toLocaleDateString("de-DE"))),$(".alert.message-abo-orders").removeClass("d-none").find("span").html(t.join(", "))):$(".alert.message-abo-orders").addClass("d-none")})),$(".modal-checkout form input, .modal-checkout form select.order-quantity, .modal-checkout form select.pos-select").change((function(){console.log("detect checkout/order modal form change");var e=$(this).parents("form"),t=$(this).parents(".modal-checkout");e.serialize();if($(this).hasClass("order-quantity")){var o=$(this).parents("tr").data("product"),a=this.value;if((t=$(this).parents(".modal-checkout")).hasClass("in-checkout")){var n=$(this).parents("tr").data("ordered-quantity");n&&(a-=n),updateProduct(t,o,a,!0)}else updateProduct(t,o,a,!1);setTotalPrice(t)}var s=0,d=0;e.find("tr.product select").each((function(){var e=$(this).parents("tr").data("ordered-quantity"),t=parseInt($(this).val());d+=t,s+=e-t})),0===d?e.hasClass("has_order")?updateModalStorno(t):updateModalEmpty(t):s>0||e.dirty("isDirty")?updateModalChange(t):updateModalUnchange(t)}))}));var navbar=document.getElementById("navbar");navbar&&!navbar.classList.contains("nav-bg-dark")&&(window.onscroll=function(){document.body.scrollTop>=200||document.documentElement.scrollTop>=200?navbar.classList.add("nav-bg-dark"):navbar.classList.remove("nav-bg-dark")});const myCollapsible=document.getElementById("navbarSupportedContent"),header=document.querySelector("header");myCollapsible&&(myCollapsible.addEventListener("show.bs.collapse",(e=>{navbar.classList.add("nav-bg-dark"),header.classList.add("open"),document.body.classList.add("position-fixed-mobile")})),myCollapsible.addEventListener("hidden.bs.collapse",(e=>{header.classList.remove("open"),document.body.classList.remove("position-fixed-mobile"),document.body.scrollTop>=200||document.documentElement.scrollTop>=200||navbar.classList.remove("nav-bg-dark")}))),$((function(){$('a[href^="http"], a[href^="/documents/"]').attr({target:"_blank",rel:"nofollow noopener"}),$('a[href^="/documents/"]').attr({target:"_blank"}),$("#id_message").change((function(){this.closest("form").submit()}));if($("#basket").length){var e=$("#basket").offset().top;$(window).scroll((function(){$(window).scrollTop()>e-77?$("header .shopping-basket").removeClass("invisible"):$("header .shopping-basket").addClass("invisible")}))}}));
