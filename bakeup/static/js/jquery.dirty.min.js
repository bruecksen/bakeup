!function(t){var i=[],e="dirty",n="clean",s="dirtyInitialValue",r=function(t){t.form.find("input, select, textarea").on("change.dirty click.dirty keyup.dirty keydown.dirty blur.dirty",(function(i){t.checkValues(i)})),t.form.on("dirty",(function(){"function"==typeof t.options.onDirty&&t.options.onDirty()})),t.form.on("clean",(function(){"function"==typeof t.options.onClean&&t.options.onClean()}))},a=function(e,s){this.form=e,this.isDirty=!1,this.options=s,this.history=[n,n],this.id=t(e).attr("id"),i.push(this)};a.prototype={init:function(){this.saveInitialValues(),this.setEvents()},isRadioOrCheckbox:function(i){return t(i).is(":radio, :checkbox")},isFileInput:function(i){return t(i).is(":file")},saveInitialValues:function(){var i=this;this.form.find("input, select, textarea").each((function(e,n){var r=i.isRadioOrCheckbox(n),a=i.isFileInput(n);if(r){var o=t(n).is(":checked")?"checked":"unchecked";t(n).data(s,o)}else a?t(n).data(s,JSON.stringify(n.files)):t(n).data(s,t(n).val()||"")}))},refreshEvents:function(){!function(t){t.form.find("input, select, textarea").off("change.dirty click.dirty keyup.dirty keydown.dirty blur.dirty"),t.form.off("dirty"),t.form.off("clean")}(this),r(this)},showDirtyFields:function(){return this.form.find("input, select, textarea").filter((function(i,e){return t(e).data("isDirty")}))},setEvents:function(){!function(i){i.form.on("submit",(function(){i.submitting=!0})),i.options.preventLeaving&&t(window).on("beforeunload",(function(t){if(i.isDirty&&!i.submitting)return t.preventDefault(),i.options.leavingMessage}))}(this),r(this)},isFieldDirty:function(t){var i=t.data(s);null==i&&(i="");var e=t.val();null==e&&(e="");var n=/^(true|false)$/i;return n.test(i)&&n.test(e)?!new RegExp("^"+i+"$","i").test(e):e!==i},isFileInputDirty:function(t){var i=t.data(s),e=t[0];return JSON.stringify(e.files)!==i},isCheckboxDirty:function(t){return t.data(s)!==(t.is(":checked")?"checked":"unchecked")},checkValues:function(i){var e=this,n=!1;this.form.find("input, select, textarea").each((function(i,s){var r,a=e.isRadioOrCheckbox(s),o=e.isFileInput(s),c=t(s);r=a?e.isCheckboxDirty(c):o?e.isFileInputDirty(c):e.isFieldDirty(c),c.data("isDirty",r),n|=r})),n?e.setDirty():e.setClean()},setDirty:function(){this.isDirty=!0,this.history[0]=this.history[1],this.history[1]=e,(this.options.fireEventsOnEachChange||this.wasJustClean())&&this.form.trigger("dirty")},setClean:function(){this.isDirty=!1,this.history[0]=this.history[1],this.history[1]=n,(this.options.fireEventsOnEachChange||this.wasJustDirty())&&this.form.trigger("clean")},wasJustDirty:function(){return this.history[0]===e},wasJustClean:function(){return this.history[0]===n},setAsClean:function(){this.saveInitialValues(),this.setClean()},setAsDirty:function(){this.saveInitialValues(),this.setDirty()},resetForm:function(){var i=this;this.form.find("input, select, textarea").each((function(e,n){var r=t(n),a=i.isRadioOrCheckbox(n),o=i.isFileInput(n);if(a){var c="checked"===r.data(s);r.prop("checked",c)}if(o)n.value="",t(n).data(s,JSON.stringify(n.files));else{var f=r.data(s);r.val(f)}})),this.checkValues()}},t.fn.dirty=function(e){if("string"==typeof e&&/^(isDirty|isClean|refreshEvents|resetForm|setAsClean|setAsDirty|showDirtyFields)$/i.test(e)){var n=(s=t(this).attr("id"),i.forEach((function(t){t.id===s&&(r=t)})),r);switch(n||(n=new a(t(this),e)).init(),e.toLowerCase()){case"isclean":return!n.isDirty;case"isdirty":return n.isDirty;case"refreshevents":n.refreshEvents();case"resetform":n.resetForm();case"setasclean":return n.setAsClean();case"setasdirty":return n.setAsDirty();case"showdirtyfields":return n.showDirtyFields()}}else if("object"==typeof e||!e)return this.each((function(i,n){e=t.extend({},t.fn.dirty.defaults,e),new a(t(n),e).init()}));var s,r},t.fn.dirty.defaults={preventLeaving:!1,leavingMessage:"There are unsaved changes on this page which will be discarded if you continue.",onDirty:t.noop,onClean:t.noop,fireEventsOnEachChange:!1}}(jQuery);
